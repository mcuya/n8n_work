{"createdAt":"2025-09-17T18:50:37.921Z","updatedAt":"2025-09-19T15:47:36.802Z","id":"KVW9hshItNEvzyI4","name":"Error Handler - ReadQueueXmlGenerate","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"35dc0459-f153-4f2d-a28c-ad53ec4c149e","name":"On Error","type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[320,304]},{"parameters":{"jsCode":"\nconst e = $json;\nconst wfName = e.workflow?.name || 'Workflow';\nconst nodeName = e.node?.name || 'N/A';\nconst ts = new Date(e.timestamp || Date.now()).toISOString();\nconst subject = `🚨 Error en ${wfName} | Nodo: ${nodeName}`;\nconst lines = [];\n\nlines.push(`🧩 Workflow: ${wfName} (id: ${e.workflow?.id || 'N/A'})`);\nlines.push(`🕒 Timestamp: ${ts}`);\nlines.push(`🔧 Nodo: ${nodeName} (${e.node?.type || 'N/A'})`);\nlines.push(`❗ Mensaje: ${e.error?.message || 'N/A'}`);\nif (e.error?.description) lines.push(`📝 Descripción: ${e.error.description}`);\nif (e.error?.stack) lines.push(`\\n🧵 Stack:\\n${e.error.stack}`);\n\n// Intentar extraer originaldata\nlet originaldata = null;\n\nif (e.execution?.data?.resultData?.runData) {\n  originaldata = Object.values(e.execution.data.resultData.runData)\n    .flat()\n    .find(i => i?.data?.originaldata)?.data?.originaldata;\n\n  if (originaldata) {\n    lines.push(`\\n📦 Payload original (originaldata):\\n${JSON.stringify(originaldata, null, 2)}`);\n  }\n}\n\nlines.push(`\\n📦 JSON completo del evento de error:\\n${JSON.stringify(e, null, 2)}`);\n\nreturn [{\n  json: {\n    subject,\n    body: lines.join('\\n'),\n    originaldata: originaldata ? JSON.stringify(originaldata) : 'NO_DATA'\n  }\n}];\n"},"id":"a17332a1-9afc-40e5-a860-b7e1cfcea55f","name":"Construye Email","type":"n8n-nodes-base.code","typeVersion":2,"position":[544,304]},{"parameters":{"subject":"={{ $json.subject }}","emailType":"text","message":"={{ $json.body }}","options":{"appendAttribution":false}},"id":"a95d119c-f64b-440c-a6fb-3ed915e7f22d","name":"Enviar Gmail","type":"n8n-nodes-base.gmail","typeVersion":2,"position":[320,80],"webhookId":"cf75e44a-36f1-44df-800f-b5e8a9790d53","disabled":true},{"parameters":{"schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"errores_n8n","mode":"list","cachedResultName":"errores_n8n"},"columns":{"mappingMode":"defineBelow","value":{"descripcion":"={{ $('On Error').item.json.execution.error.message }}","payload":"={{ $json.originaldata || '' }}"},"matchingColumns":[],"schema":[{"id":"codigo","displayName":"codigo","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"descripcion","displayName":"descripcion","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"payload","displayName":"payload","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[752,320],"id":"efbec45d-1a3e-41b1-9e71-e5a7561c2d74","name":"Insert rows in a table","credentials":{"postgres":{"id":"d53NEEOjDqHRzRm6","name":"Postgres account 2"}}},{"parameters":{"method":"POST","url":"http://10.208.101.92:1801/api/CRUD/sendEmail","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"email\": \"franklin.milla@dpworld.com\",\n    \"subject\": \"TEST SUBJECT con HTML\",\n    \"body\": \"{{ $('On Error').item.json.execution.error.message }}\"\n}","options":{"allowUnauthorizedCerts":true}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[768,80],"id":"db9099df-a562-4b40-a353-c5a0a8de9a09","name":"HTTP Request","disabled":true}],"connections":{"On Error":{"main":[[{"node":"Construye Email","type":"main","index":0}]]},"Construye Email":{"main":[[{"node":"Insert rows in a table","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"da7093eb-a451-423b-a99d-b2b9fb64b78c","triggerCount":0,"shared":[{"createdAt":"2025-09-17T18:50:37.921Z","updatedAt":"2025-09-17T18:50:37.921Z","role":"workflow:owner","workflowId":"KVW9hshItNEvzyI4","projectId":"qKHJHnveidvROPB6"}],"tags":[]}