{"updatedAt":"2026-02-09T21:49:55.205Z","createdAt":"2026-02-06T20:29:48.221Z","id":"96-l_SSrgFm09DlMyYEzB","name":"GeneraQueryFromExcelAprobacionAutomatica","active":false,"isArchived":false,"nodes":[{"parameters":{"operation":"xlsx","binaryPropertyName":"Archivo","options":{"headerRow":true,"includeEmptyCells":true}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[1408,1936],"id":"69090ac0-263a-4935-85c4-9566b1421ed8","name":"Extract from File"},{"parameters":{"formTitle":"Carga Archivo","formDescription":"Carga Archivo","formFields":{"values":[{"fieldName":"Archivo","fieldLabel":"Archivo","fieldType":"file","multipleFiles":false,"acceptFileTypes":".xlsx, xls","requiredField":true}]},"responseMode":"lastNode","options":{"appendAttribution":false}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.4,"position":[1072,1936],"id":"317f7d31-e10d-43f1-bf25-a9c94fc37c92","name":"CargarArchivo","webhookId":"d41e83e1-a855-4411-8a12-a5025b109954"},{"parameters":{"promptType":"define","text":"={{ JSON.stringify($json) }}","options":{"systemMessage":"=Eres un experto generando queries para Oracle. El usuario te entregará un JSON con los datos de UNA SOLA FILA del Excel.\n\nCon esa fila, genera UN (1) MERGE para la tabla AFOR.INSPAPROBACIONAUTOMATICA.\n- Los campos distintos, por los que debes hacer merge son: LINEACODIGO, TIPOCONTENEDOR, TAMANIOCONTENEDOR, TECNOLOGIA, TOPOLOGYID y TIPOLIMPIEZAACEPTADO. Valida siempre que el campo TECNOLOGIA puede ser null.\n- Devuelve SOLO SQL en formato plano sin saltos de linea ni caracteres especiales.\n- No pidas más información.\n- Si un campo viene vacío, usa NULL.\n- para el campo FECHACREACION usa el sysdate si es INSERT si es UPDATE NO lo actualices en su lugar usa el campo FECHAACTUALIZACION con el valor SYSDATE\n- para el campo CREADOR usa el \"n8n_user\" si es INSERT si es UPDATE NO lo actualices en su lugar usa el campo ACTUALIZADOR con el valor \"n8n_user\"\n- para el sequence del ID usa el sequence AFOR.INSPAPROBACIONAUTOMATICA_SEQ\n\nEstructura de la tabla:\n  CREATE TABLE \"AFOR\".\"INSPAPROBACIONAUTOMATICA\" (\n  \"ID\" NUMBER(19,0) NOT NULL ENABLE,\n  \"LINEAGKEY\" NUMBER(19,0),\n  \"LINEACODIGO\" VARCHAR2(5 BYTE),\n  \"TIPOCONTENEDOR\" VARCHAR2(15 BYTE),\n  \"TAMANIOCONTENEDOR\" VARCHAR2(15 BYTE),\n  \"TECNOLOGIA\" VARCHAR2(15 BYTE) DEFAULT NULL,\n  \"DIASVALIDEZPTI\" NUMBER(5,0),\n  \"PTIACEPTADO\" CHAR(2 BYTE),\n  \"PRESUPUESTOACEPTADO\" CHAR(2 BYTE),\n  \"LEAKTESTACEPTADO\" CHAR(2 BYTE),\n  \"LIMITEPRESUPUESTOCAJA\" NUMBER(16,4),\n  \"LIMITEPRESUPUESTOMAQUINA\" NUMBER(16,4),\n  \"LIMITEPRESUPUESTOTOTAL\" NUMBER(16,4),\n  \"LIMITEPRESUPUESTOLIMPIEZA\" NUMBER(16,4),\n  \"TOPOLOGYID\" NUMBER(19,0),\n  \"TIPOLIMPIEZAACEPTADO\" VARCHAR2(15 BYTE),\n  \"IDESTADO\" NUMBER(5,0),\n  \"CREADOR\" VARCHAR2(50 BYTE) DEFAULT NULL,\n  \"FECHACREACION\" TIMESTAMP(6),\n  \"ACTUALIZADOR\" VARCHAR2(50 BYTE) DEFAULT NULL,\n  \"FECHAACTUALIZACION\" TIMESTAMP(6)\n  );"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[1696,1936],"id":"abccf1c1-7fbf-4567-a26d-9b11f2c02725","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[1696,2176],"id":"86159d40-7cbc-4cbc-8a47-44fb39c06db8","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"lNzaDvTxnmr5Mm19","name":"OpenAiChatBot"}}},{"parameters":{"content":"## Carga Archivo Excel\n#### Formato Aprobaciones Automáticas","height":288,"width":320},"type":"n8n-nodes-base.stickyNote","position":[960,1808],"typeVersion":1,"id":"6ed2e068-be19-4301-9006-16c2922bb60e","name":"Sticky Note"},{"parameters":{"content":"## Extrae Datos del Archivo\n#### Formato Aprobaciones Automáticas","height":288,"width":320,"color":3},"type":"n8n-nodes-base.stickyNote","position":[1296,1808],"typeVersion":1,"id":"23aa548d-e167-410d-9aa0-517f9c9bec82","name":"Sticky Note1"},{"parameters":{"content":"## Agente IA\n#### Lee Formato Aprobaciones Automáticas y lo convierte a SQL (Merge)","height":288,"width":480,"color":4},"type":"n8n-nodes-base.stickyNote","position":[1632,1808],"typeVersion":1,"id":"b5f31749-87fb-420a-8bab-653c1ff66913","name":"Sticky Note2"},{"parameters":{"content":"# Aprobación Automatica M&R","height":656,"width":1280,"color":6},"type":"n8n-nodes-base.stickyNote","position":[896,1648],"typeVersion":1,"id":"ae54c45c-25a6-4f2d-bb28-70bdb26b8693","name":"Sticky Note3"}],"connections":{"CargarArchivo":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"930472c3-f04f-4778-a85d-05fc309d9339","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-02-06T20:29:48.221Z","createdAt":"2026-02-06T20:29:48.221Z","role":"workflow:owner","workflowId":"96-l_SSrgFm09DlMyYEzB","projectId":"qKHJHnveidvROPB6"}],"activeVersion":null,"tags":[{"updatedAt":"2026-02-09T12:36:18.570Z","createdAt":"2026-02-09T12:36:18.570Z","id":"zfkG0He1jWaRWJ19","name":"M&R"}]}